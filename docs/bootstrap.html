<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Bootstraping the Minimum and Maximum Annual Soil Respiration Differences</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Soil Project:  R for Earth-System Science Final</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="intro.html">Introduction to Dataset</a>
    </li>
    <li>
      <a href="subsetting.html">Choosing a Subset</a>
    </li>
    <li>
      <a href="cleaning.html">Exploratory Data Analysis and General Cleaning</a>
    </li>
    <li>
      <a href="bootstrap.html">Bootstrapping: Minimum/Maximum Differences</a>
    </li>
    <li>
      <a href="conclusion.html">Analysis and Concusion</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About Project</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Bootstraping the Minimum and Maximum Annual
Soil Respiration Differences</h1>

</div>


<div
id="estimating-the-average-difference-between-the-minimum-and-maximum-soil-respiration-levels-from-1999-t0-2015-in-eastern-china"
class="section level1">
<h1>Estimating the Average Difference Between the Minimum and Maximum
Soil Respiration Levels from 1999 t0 2015 in Eastern China</h1>
<p>A great tool at our disposal here is bootstrapping. We have a small
number of samples, and to begin with there is an element of estimation
in this statistic because it would be nearly impossible and extremely
expensive to measure the respiration levels in soil across all of
Eastern China over the course of many years, but what we do have, is a
somewhat sparse data set.</p>
<p>Throughout this project the biggest challenge has dealing with very
spread out limited data, however, we have cleaned up our table and we
can now run a bootstrap simulation to quantify the confidence interval
of the mean difference between min and max values.</p>
<p>The process of bootstrapping is fairly straightforward, we will be
sampling our cleaned dataset, with replacement, calculating the mean
difference between the highest annual soil respiration value and the
lowest annual soil respiration values for 1995 and 2015 in that sampled
set. We will then do this many times to create a normal distribution of
sampled mean values. This will give us a confidence interval of that
change.</p>
<p>We can then proceed to repeat this porcess to better understand what
a true population mean might look like. We then will compare this to the
value that we actually observe with the given data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;sf&quot;</span>)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;readr&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<pre><code>## ── Attaching core tidyverse packages ───────────────────────────────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ stringr   1.5.1
## ✔ forcats   1.0.0     ✔ tibble    3.2.1
## ✔ lubridate 1.9.3     ✔ tidyr     1.3.0
## ✔ purrr     1.0.2</code></pre>
<pre><code>## ── Conflicts ─────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tibble&quot;</span>)</span></code></pre></div>
</div>
<div id="beginning-bootstrapping-process" class="section level1">
<h1>Beginning Bootstrapping Process:</h1>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">#import cleaned dataset:</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>RS_full <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;china_clean.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 259 Columns: 74
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (22): Entry_date, Author, Quality_flag, Contributor, Country, Region, Site_name, Site_ID, Manipul...
## dbl (52): Record_number, Study_number, Study_midyear, YearsOfData, Latitude, Longitude, Elevation, Ag...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">#lets just grab the two columns we are interested in:</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>RS <span class="ot">&lt;-</span> RS_full[, <span class="fu">c</span>(<span class="st">&#39;Study_midyear&#39;</span>, <span class="st">&#39;Rs_annual&#39;</span>)]</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">head</span>(RS)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   Study_midyear Rs_annual
##           &lt;dbl&gt;     &lt;dbl&gt;
## 1         2004.       785
## 2         2004.       813
## 3         2004.       786
## 4         2004.       781
## 5         2004.       514
## 6         2004.       403</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co">#make a function that can compute the mean difference of a dataframe column:</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>rs_mean <span class="ot">&lt;-</span> <span class="cf">function</span> (data, i){</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  highs_and_lows<span class="ot">&lt;-</span> data[i, ] <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Study_midyear) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">High =</span> <span class="fu">max</span>(Rs_annual), <span class="at">Min =</span> <span class="fu">min</span>(Rs_annual))</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  differences <span class="ot">&lt;-</span> (highs_and_lows<span class="sc">$</span>High <span class="sc">-</span> highs_and_lows<span class="sc">$</span>Min)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(differences))}</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># import the bootstap package</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>one_bootstrap <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data =</span> RS, <span class="at">statistic =</span> rs_mean, <span class="at">R =</span> <span class="dv">1000</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="fu">return</span> (result)}</span></code></pre></div>
<p>Great, now we have some infrastructure to run bootstrap simulations.
First off let’s investigate one bootstrap iteration and its associated
confidence interval:</p>
</div>
<div
id="visualizing-the-confidence-interval-of-one-bootstrapped-simmulation"
class="section level1">
<h1>Visualizing the Confidence Interval of One Bootstrapped
Simmulation:</h1>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co">#get one set bootstrap statistics</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>boot_results <span class="ot">&lt;-</span> <span class="fu">one_bootstrap</span>()<span class="sc">$</span>t</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co"># find the mean and CI </span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>boot_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(boot_results)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#we are looking at the middle 95%</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>boot_ci <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot_results, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co"># for plotting the data, we can all of the sub iterations into a DataFrame</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mean_statistic =</span> boot_results)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co"># Plot using ggplot2</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> mean_statistic)) <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>, <span class="at">fill =</span> <span class="st">&quot;skyblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>  <span class="co">#Plotting the CI</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> boot_ci[<span class="dv">1</span>], <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> boot_ci[<span class="dv">2</span>], <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>  <span class="co">#plotting the mean</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> boot_mean, <span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Mean Difference&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Simulated Mean Difference&quot;</span>)</span></code></pre></div>
<p><img src="bootstrap_files/figure-html/unnamed-chunk-5-1.png" width="2100" />
lets just make sure we get two different sets of results if we run our
simulation agian:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">#get one set bootstrap statistics</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>boot_results <span class="ot">&lt;-</span> <span class="fu">one_bootstrap</span>()<span class="sc">$</span>t</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># find the mean and CI </span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>boot_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(boot_results)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#we are looking at the middle 95%</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>boot_ci <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot_results, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co"># for plotting the data, we can all of the sub iterations into a DataFrame</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mean_statistic =</span> boot_results)</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co"># Plot using ggplot2</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> mean_statistic)) <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>, <span class="at">fill =</span> <span class="st">&quot;skyblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  <span class="co">#Plotting the CI</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> boot_ci[<span class="dv">1</span>], <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> boot_ci[<span class="dv">2</span>], <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>  <span class="co">#plotting the mean</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> boot_mean, <span class="at">color =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Mean Difference&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Simulated Mean Difference with Confidence Intervals &amp; Mean &quot;</span>)</span></code></pre></div>
<p><img src="bootstrap_files/figure-html/unnamed-chunk-6-1.png" width="2100" />
Now we can run this simulation a set number of times to determine the
distribution of bootstrapped means and confidence intervals (because you
can see that they also vary by simulation)</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co">#how many bootstraps to run</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># Creating an empty dataframe to store each new value of the BS</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>ci_and_stat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">integer</span>(),</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  <span class="at">low =</span> <span class="fu">double</span>(),</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="at">high =</span> <span class="fu">double</span>(), </span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  <span class="at">mean_bs =</span> <span class="fu">double</span>()</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>)</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co"># Running the simulation</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="cf">for</span> (num <span class="cf">in</span> n) {</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>  <span class="co"># Run one bootstrap</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>  boot_stat <span class="ot">&lt;-</span> <span class="fu">one_bootstrap</span>()<span class="sc">$</span>t</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>  </span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>  <span class="co"># Get the CIs</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>  boot_ci <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot_stat, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>  low_ci <span class="ot">&lt;-</span> boot_ci[<span class="dv">1</span>]</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>  high_ci <span class="ot">&lt;-</span> boot_ci[<span class="dv">2</span>]</span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>  </span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>  <span class="co"># Add it to the dataframe</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>  ci_and_stat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ci_and_stat, <span class="fu">tibble</span>(</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>    <span class="at">n =</span> num,</span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>    <span class="at">low =</span> low_ci,</span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a>    <span class="at">high =</span> high_ci,</span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a>    <span class="at">mean_bs =</span> <span class="fu">mean</span>(boot_stat)</span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>  ))</span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a>}</span></code></pre></div>
<p>Awesome, now we can plot these to see the distribution of confidence
intervals and get a pretty good gauge of our simulated statistic in
comparison to the observed mean difference:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co">#specify our x and y values</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> ci_and_stat<span class="sc">$</span>n</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> ci_and_stat<span class="sc">$</span>mean_bs</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#get true mean</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>highs_and_lows<span class="ot">&lt;-</span> RS <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Study_midyear) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">High =</span> <span class="fu">max</span>(Rs_annual), <span class="at">Min =</span> <span class="fu">min</span>(Rs_annual))</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>rs_mean_difference <span class="ot">&lt;-</span> <span class="fu">mean</span>((highs_and_lows<span class="sc">$</span>High <span class="sc">-</span> highs_and_lows<span class="sc">$</span>Min))</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="fu">ggplot</span>(ci_and_stat, <span class="fu">aes</span>(x, y)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span>  </span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> low, <span class="at">ymax =</span> high)) <span class="sc">+</span> </span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Bootstrap Iteration&quot;</span>, <span class="at">y=</span><span class="st">&quot;Annual Respiration&quot;</span>, <span class="at">main=</span><span class="st">&quot;Distribution of Confidence Intervals in Relation to Observed Statisitc&quot;</span>) <span class="sc">+</span> </span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>   <span class="fu">geom_hline</span>(<span class="at">yintercept=</span>rs_mean_difference, <span class="at">color =</span> <span class="st">&quot;Red&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="bootstrap_files/figure-html/unnamed-chunk-8-1.png" width="2100" /></p>
</div>
<div id="observations" class="section level1">
<h1>Observations</h1>
<p>Wild, we can see here that our observed mean difference is
statistically significant. Which means that the value we observed with
the current sample doesn’t necessarily reflect that of the true
population.</p>
<p>A potential reason for this is that there may be bias or outliers in
the subset of data (which makes sense, we manipulated a lot here, but we
are only exploring, and not drawing any major conclusions).</p>
<p>Looking back on our line plot, we see that there does seem to be a
huge difference between the highest and lowest values in the years 2011,
and 2012 which might be having a large impact on the observation
statistic, but it might not represent the population well at all.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
