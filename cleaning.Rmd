
---
title:  Exploratory Data Analysis and General Cleaning
output:
  html_document:
    fig_caption: no
    number_sections: no
    toc: no
    toc_float: false
    collapsed: no
---

```{r set-options, echo=FALSE, strip.white=TRUE}
options(width = 105)
knitr::opts_chunk$set(dev='png', dpi=300, cache=TRUE)
pdf.options(useDingbats = TRUE)
```

# Introduction #
Data Inspection and Cleaning:
```{r}
library("maps")
library("mapdata")
library("sf")
library("ggplot2")
library("readr")
library("tidyverse")
```

```{r}
#read in our data:
china <- read_csv("china_soil_respiration.csv")

#lets get a summary of what we have here:
summary(china)
```
Great, we see the length of this set is 663, and we have a very large amount of NULL values which is one of the main obsicles with this dataset.
```{r}
colSums(is.na(china))
```

Great, now lets drop all the rows that don't contain information about the annual Soil respiration (the column Rs_annual), and drop the empty columns because those will render useles to us.
```{r}
#drop rows with no annual rs:
china <- china %>% drop_na(Rs_annual)
china <-  china %>% drop_na(Longitude)
china <- china %>% drop_na(Latitude)
#drop cols with no data:
na_props <- colMeans(is.na(china))
na_props
full_columns <- na_props != 1
full_columns
#keep only those columns
cleaned_china <- china[, full_columns]
cleaned_china 
```


Okay that seems much better, lets take a look at the distribution of soil respiration:

```{r}
hist(cleaned_china$Rs_annual)
```
```{r}
#hist(cleaned_china$Latitude)
```
```{r}
#hist(cleaned_china$Longitude)
```


```{r}
china_map = map_data("worldHires", region = "china")
```
```{r}
ggplot() +
  geom_polygon(data = china_map, aes(x = long, y = lat, group = group), fill = "lightblue", color='black') +
  geom_point(data = cleaned_china, aes(x = Longitude+rnorm(n=nrow(cleaned_china)), y = Latitude+rnorm(n=nrow(cleaned_china)), color=Rs_annual)) +
  coord_map(projection = "mercator") + 
  labs(title = "Map of Soil Sample Sites in China", x = "Longitude", y = "Latitude")
```
Great now lets take a looka th the mean anual RS over the course of the studies here:

First we need to calculate the mean for each year:
```{r}
names(cleaned_china)
```

```{r}
Rs_median <- cleaned_china %>% group_by(Study_midyear) %>% summarize(Median = median(Rs_annual), High = max(Rs_annual), Min = min(Rs_annual))
Rs_median
```

```{r}
mmm <- ggplot(Rs_median, aes(x = Study_midyear)) +
  geom_line(aes(y = Median, color = "Median")) +
  geom_line(aes(y = High, color = "Maximum")) +
  geom_line(aes(y = Min, color = "Minimum")) +
  labs(x = "Study Midyear", y = "Rs Annual", title = "Median, Maximum, and Minimum Rs Annual Over Study Midyear") +
  scale_color_manual(values = c("Median" = "darkblue", "Maximum" = "darkred", "Minimum" = "darkgreen")) +
  theme_minimal()
mmm
```

We see here the temporal changes from 1999 to 2015, and we see how the soil respiration really fluctuates from ear to year with and interesting pattern. what is very interesting to me are the gaps between the min and max values for each year. This is what we will investigate int he next section. 


```{r}
#export as new csv for bootstapping:
write.csv(cleaned_china, file = "china_clean.csv", row.names = FALSE)
```

